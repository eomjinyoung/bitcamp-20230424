<!DOCTYPE html>
<html>
<head>
    <meta charset='UTF-8'>
    <title>비트캠프</title>
    <link rel="stylesheet" href="/css/common.css">
</head>
<body>

<header class="x-page-header"></header>

<h1>게시글</h1>
<form id="x-board-form" enctype='multipart/form-data'>
제목 <input type='text' name='title'><br>
내용 <textarea name='content'></textarea><br>
파일 <input type='file' name='files' multiple><br>
<input id="x-category" type='hidden' name='category'>
<button>등록</button>
</form>

<footer class="x-page-footer"></footer>

<script src="/js/common.js"></script>
<script>
    "use strict";

    const boardForm = document.querySelector("#x-board-form");

    loadHTML("header", "http://localhost/header.html");
    loadHTML("footer", "http://localhost/footer.html");

    document.querySelector("#x-category").value = pageContext.params.category;

    boardForm.onsubmit = (e) => {
        e.preventDefault();
        const formData = new FormData(boardForm);
        const xhr = new XMLHttpRequest();
        xhr.onreadystatechange = () => {
            if (xhr.readyState == 4) {
                if (xhr.status == 200) {
                    var result = JSON.parse(xhr.responseText);
                    //console.log(result);
                    if (result.status == "success") {
                        location.href = `list.html?category=${pageContext.params.category}`;
                    } else {
                        alert("게시글 등록 오류입니다!");
                    }
                }
            }
        };
        xhr.open("POST" , `/boards/${pageContext.params.category}` , true);
        xhr.send(formData);
    };
</script>
</body>
</html>